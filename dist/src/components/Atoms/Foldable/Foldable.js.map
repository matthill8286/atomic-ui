{"version":3,"file":"Foldable.js","sources":["../../../../../src/components/Atoms/Foldable/Foldable.tsx"],"sourcesContent":["import React from 'react'\nimport { styled } from '@/styles/styled'\nimport { FoldableProps, FoldableState } from './Foldable.interface'\n\nexport const StyledFoldable = styled.div<{ looksOpenFromBreakpoint?: number }>`\n  overflow: hidden;\n\n  ${({ looksOpenFromBreakpoint }) =>\n    looksOpenFromBreakpoint &&\n    `\n    @media (min-width: ${looksOpenFromBreakpoint}px) {\n      height: auto !important;\n    }\n  `}\n`\n\nexport class Foldable extends React.Component<FoldableProps, FoldableState> {\n  private entryRef: React.RefObject<HTMLDivElement>\n  private standardDuration: number\n  private maxDuration: number\n\n  constructor(props: FoldableProps) {\n    super(props)\n    this.entryRef = React.createRef()\n    this.standardDuration = 300\n    this.maxDuration = 1000\n\n    this.state = {\n      height: this._getHeight(),\n      transition: `height ${this.standardDuration}ms linear`,\n      looksOpenFromBreakpoint: props.looksOpenInitiallyFromBreakpoint,\n    }\n  }\n\n  public componentDidMount() {\n    if (this.props.isOpen) {\n      this._updateHeightBeforeTransition()\n    }\n  }\n\n  public componentDidUpdate(prevProps: FoldableProps) {\n    if (this.props.isOpen !== prevProps.isOpen) {\n      this._updateHeightBeforeTransition()\n    }\n  }\n\n  public render() {\n    const { isOpen: _isOpen, ...rest } = this.props\n    const { looksOpenFromBreakpoint } = this.state\n    return (\n      <StyledFoldable\n        data-test={'foldable'}\n        style={this._applyTransition()}\n        onTransitionEnd={this._afterTransition}\n        className={this.props.className}\n        looksOpenFromBreakpoint={looksOpenFromBreakpoint}\n        {...rest}>\n        <div data-test=\"inner-foldable\" ref={this.entryRef}>\n          {this.props.children}\n        </div>\n      </StyledFoldable>\n    )\n  }\n\n  private _afterTransition = () => {\n    const { isOpen } = this.props\n    if (isOpen) {\n      this.setState({\n        height: 'auto',\n      })\n    }\n  }\n\n  private _scrollToElement(duration: number) {\n    const currentElement = this.entryRef.current\n\n    setTimeout(() => {\n      const rect = currentElement?.getBoundingClientRect() || { top: 0 }\n      if (rect.top < 0) {\n        // reset viewport to calculate the right position\n        window.scrollTo(0, 0)\n        const rectUpdate = currentElement?.getBoundingClientRect() || { top: 0, height: 0 }\n        window.scrollTo(0, rectUpdate.top - rectUpdate.height)\n      }\n    }, duration)\n  }\n\n  private _updateHeightBeforeTransition() {\n    const { looksOpenFromBreakpoint } = this.state\n    const isTransitionCancelled = !!looksOpenFromBreakpoint\n    const currentElement = this.entryRef.current\n    const calculatedDuration = this._getDuration()\n    const animationType = this._getAnimationType(calculatedDuration)\n\n    const height = isTransitionCancelled ? 'auto' : currentElement?.clientHeight ?? 'auto'\n    const transition = isTransitionCancelled\n      ? ''\n      : `height ${calculatedDuration}ms ${animationType}`\n\n    this.setState(\n      {\n        height,\n        transition,\n        looksOpenFromBreakpoint: undefined,\n      },\n      () => {\n        if (!this.props.isOpen) {\n          this._updateTransition()\n        } else {\n          this._scrollToElement(calculatedDuration)\n        }\n      }\n    )\n  }\n\n  private _getDuration() {\n    const { isOpen } = this.props\n    const currentElement = this.entryRef.current\n    const calcDuration = !!currentElement && currentElement.clientHeight / 2\n\n    if (calcDuration) {\n      if (!isOpen) {\n        return this.standardDuration\n      } else if (calcDuration > this.maxDuration) {\n        return this.maxDuration\n      } else if (calcDuration < this.standardDuration) {\n        return this.standardDuration\n      } else {\n        return calcDuration\n      }\n    } else {\n      return this.standardDuration\n    }\n  }\n\n  private _getAnimationType(calculatedDuration: number) {\n    const { isOpen } = this.props\n    return calculatedDuration === this.standardDuration ? 'linear' : isOpen ? 'ease-in' : 'ease-out'\n  }\n\n  private _updateTransition() {\n    const calculatedDuration = this._getDuration()\n    const animationType = this._getAnimationType(calculatedDuration)\n    this.setState({\n      height: this._getHeight(),\n      transition: `height ${calculatedDuration}ms ${animationType}`,\n    })\n  }\n\n  private _applyTransition() {\n    return {\n      height: this.state.height,\n      transition: this.state.transition,\n    }\n  }\n\n  private _getHeight() {\n    const { isOpen } = this.props\n    return isOpen ? 'auto' : 0\n  }\n}\n"],"names":["StyledFoldable","styled","div","looksOpenFromBreakpoint","Foldable","props","_this","isOpen","setState","height","entryRef","React","createRef","standardDuration","maxDuration","state","_getHeight","transition","looksOpenInitiallyFromBreakpoint","this","_updateHeightBeforeTransition","prevProps","rest","style","_applyTransition","onTransitionEnd","_afterTransition","className","ref","children","duration","currentElement","current","setTimeout","getBoundingClientRect","top","window","scrollTo","rectUpdate","isTransitionCancelled","calculatedDuration","_getDuration","animationType","_getAnimationType","clientHeight","undefined","_this2","_scrollToElement","_updateTransition","calcDuration","Component"],"mappings":"wSAIaA,EAAiBC,EAAOC,mFAAPD,0BAG1B,gBAAGE,IAAAA,+BACHA,sCAEqBA,yDAMZC,2CAKCC,wCACJA,uHA0CmB,WACNC,EAAKD,MAAhBE,UAEDC,SAAS,CACZC,OAAQ,cA7CPC,SAAWC,EAAMC,cACjBC,iBAAmB,MACnBC,YAAc,MAEdC,MAAQ,CACXN,OAAQH,EAAKU,aACbC,4BAAsBX,EAAKO,8BAC3BV,wBAAyBE,EAAMa,+EAInC,WACMC,KAAKd,MAAME,aACRa,kEAIT,SAA0BC,GACpBF,KAAKd,MAAME,SAAWc,EAAUd,aAC7Ba,sDAIT,iBACuCD,KAAKd,QAAlCE,WAAoBe,kBACpBnB,EAA4BgB,KAAKJ,MAAjCZ,+BAENQ,gBAACX,iBACY,WACXuB,MAAOJ,KAAKK,mBACZC,gBAAiBN,KAAKO,iBACtBC,UAAWR,KAAKd,MAAMsB,UACtBxB,wBAAyBA,GACrBmB,GACJX,mCAAe,iBAAiBiB,IAAKT,KAAKT,UACvCS,KAAKd,MAAMwB,2CAepB,SAAyBC,OACjBC,EAAiBZ,KAAKT,SAASsB,QAErCC,YAAW,gBACIF,MAAAA,SAAAA,EAAgBG,0BAA2B,CAAEC,IAAK,IACtDA,IAAM,EAAG,CAEhBC,OAAOC,SAAS,EAAG,OACbC,GAAaP,MAAAA,SAAAA,EAAgBG,0BAA2B,CAAEC,IAAK,EAAG1B,OAAQ,GAChF2B,OAAOC,SAAS,EAAGC,EAAWH,IAAMG,EAAW7B,WAEhDqB,gDAGL,wBAEQS,IAD8BpB,KAAKJ,MAAjCZ,wBAEF4B,EAAiBZ,KAAKT,SAASsB,QAC/BQ,EAAqBrB,KAAKsB,eAC1BC,EAAgBvB,KAAKwB,kBAAkBH,GAEvC/B,EAAS8B,EAAwB,iBAASR,MAAAA,SAAAA,EAAgBa,4BAAgB,OAC1E3B,EAAasB,EACf,oBACUC,gBAAwBE,QAEjClC,SACH,CACEC,OAAAA,EACAQ,WAAAA,EACAd,6BAAyB0C,IAE3B,WACOC,EAAKzC,MAAME,OAGduC,EAAKC,iBAAiBP,GAFtBM,EAAKE,mDAQb,eACUzC,EAAWY,KAAKd,MAAhBE,OACFwB,EAAiBZ,KAAKT,SAASsB,QAC/BiB,IAAiBlB,GAAkBA,EAAea,aAAe,SAEnEK,GACG1C,EAEM0C,EAAe9B,KAAKL,YACtBK,KAAKL,YACHmC,EAAe9B,KAAKN,iBACtBM,KAAKN,iBAELoC,EAGF9B,KAAKN,kDAIhB,SAA0B2B,OAChBjC,EAAWY,KAAKd,MAAhBE,cACDiC,IAAuBrB,KAAKN,iBAAmB,SAAWN,EAAS,UAAY,4CAGxF,eACQiC,EAAqBrB,KAAKsB,eAC1BC,EAAgBvB,KAAKwB,kBAAkBH,QACxChC,SAAS,CACZC,OAAQU,KAAKH,aACbC,4BAAsBuB,gBAAwBE,qCAIlD,iBACS,CACLjC,OAAQU,KAAKJ,MAAMN,OACnBQ,WAAYE,KAAKJ,MAAME,sCAI3B,kBACqBE,KAAKd,MAAhBE,OACQ,OAAS,SA9ICI,EAAMuC"}