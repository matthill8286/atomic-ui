{"version":3,"file":"ScrollAssetCarousel.js","sources":["../../../../../src/components/Organisms/ScrollAssetCarousel/ScrollAssetCarousel.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { useInView } from 'react-intersection-observer'\nimport { ScrollSnapSlider } from '@/components/Molecules/ScrollSnapSlider'\nimport { Asset } from '@/types'\nimport { breakpoints } from '@/styles'\nimport {\n  AssetSponsoring,\n  AssetTile,\n  AssetTileLayout,\n  AssetTileProps,\n} from '@/components/Organisms/AssetTile'\nimport { ScrollAssetCarouselProps } from './ScrollAssetCarousel.interface'\nimport { CarouselWrapper, TileFragment, TileWrapper } from './ScrollAssetCarousel.styled'\nimport { useWindowDimensions } from '@/components/Helper'\nimport { BadgeType } from '@/components/Atoms/Badge'\n\nexport const AssetCarousel: React.FC<ScrollAssetCarouselProps> = ({\n  loading = true,\n  lazyLoad = true,\n  promoted,\n  promotedIndex = 0,\n  assets = [],\n  disabledAssetIndexes = [],\n  context = 'home-scroll-carousel',\n  tileMargin = 'md',\n  withOverflow = true,\n  withGrid = false,\n  showArrows = true,\n  showBookmark = true,\n  NoAssetsComponent,\n  showSkills = true,\n  showProvider,\n  sponsoringDetails,\n  showLock = false,\n  playlistOrientation = 'portrait',\n  playlistView = 'list',\n  playlistLayout = AssetTileLayout.gridItem,\n  strategyType,\n  videoFallbackImage,\n  fixedArrowPosition = true,\n  zeroArrowPosition = false,\n  renderAddToBookmarkButton,\n  title,\n  tileWidth = 250,\n  slidesPerPageSettings,\n  hideDummies = false,\n  dataTest,\n  withLQIP,\n  withNativeLoading,\n  withScrollbar = true,\n  onAssetClick = () => {\n    return null\n  },\n  onLockClick = () => {\n    return null\n  },\n  onSlideChange = () => {\n    return null\n  },\n  onInView,\n  arrowPrevClass,\n  arrowNextClass,\n}): JSX.Element | null => {\n  const [scrolled, scrolledSet] = useState<boolean>(false)\n  const { breakpoint } = useWindowDimensions()\n  const [prevSlideIndex, setPrevSlideIndex] = useState(0)\n\n  const assetsPerSlideWithHook =\n    breakpoint >= breakpoints.lg\n      ? slidesPerPageSettings.desktop\n      : breakpoint >= breakpoints.md\n      ? slidesPerPageSettings.tablet\n      : slidesPerPageSettings.mobileBig\n\n  const [ref, inView] = useInView({\n    threshold: 0,\n    triggerOnce: true,\n    rootMargin: '50px 0px',\n  })\n\n  useEffect(() => {\n    if (inView && onInView !== undefined && !loading && assets.length > 0) {\n      onInView({ context })\n    }\n  }, [inView, loading, onInView, context, assets])\n\n  if (!assets || assets.length < 1) {\n    return !loading ? NoAssetsComponent : null\n  }\n\n  const handleSlideChange = (assetsPerSlide: number) => (nextSlideIndex: number) => {\n    scrolledSet(false)\n    const direction = nextSlideIndex > prevSlideIndex ? 'Next' : 'Previous'\n    const slideIndex = nextSlideIndex / assetsPerSlide\n    setPrevSlideIndex(nextSlideIndex)\n    const assetsInSlide = assets.slice(\n      slideIndex * assetsPerSlide,\n      slideIndex * assetsPerSlide + assetsPerSlide\n    )\n    onSlideChange?.({\n      assets: assetsInSlide,\n      direction,\n      assetAmount: assetsPerSlide,\n      pageNumber: slideIndex,\n      context,\n    })\n  }\n\n  const handleAssetClick = (assetsPerSlide: number) => (\n    event: React.MouseEvent<HTMLElement, MouseEvent>,\n    asset: Asset | Partial<Asset>,\n    index: number,\n    pageNumber: number\n  ) => {\n    if (scrolled) {\n      event.preventDefault()\n    }\n\n    if (!asset.locked && onAssetClick) {\n      onAssetClick({ asset, index, assetsPerSlide, pageNumber, context })\n    }\n  }\n\n  const handleLockClick = (assetsPerSlide: number) => (\n    event: React.MouseEvent<HTMLElement, MouseEvent>,\n    asset: Asset | Partial<Asset>,\n    index: number,\n    pageNumber: number\n  ) => {\n    if (onLockClick) {\n      onLockClick({ asset, index, assetsPerSlide, pageNumber, context })\n    }\n  }\n\n  const tileSettings: Omit<AssetTileProps, 'asset'> = {\n    loading: loading,\n    fontSize: 'sm',\n    sponsoringDetails: undefined,\n    withEllipsis: true,\n  }\n\n  const carouselOrientation = playlistLayout === AssetTileLayout.gridItem ? 'portrait' : 'landscape'\n  const isGridLayout = playlistLayout === AssetTileLayout.gridItem\n\n  const renderAsset = (assetsPerSlide: number) => (\n    asset: Asset | Partial<Asset>,\n    index: number\n  ): JSX.Element => {\n    const slideIndex = Math.floor(index / assetsPerSlide)\n    const isDummyTile = !withOverflow && !asset.description\n\n    const assetTileAsset: Asset | Partial<Asset> = {\n      ...asset,\n    }\n\n    // no wrapper in case of sponsored asset\n    const Wrapper = sponsoringDetails?.isSponsored ? TileFragment : TileWrapper\n    const assetsWithSponsor = assetTileAsset?.sponsored\n    const loading = tileSettings.loading || isDummyTile\n    const disabled = disabledAssetIndexes.findIndex(x => x === index) !== -1\n\n    return (\n      <Wrapper\n        hideDummy={isDummyTile && hideDummies && !scrolled}\n        aria-rowindex={index}\n        key={`AssetTile-${index}`}\n        withLabels={assetsWithSponsor}>\n        <AssetTile\n          {...tileSettings}\n          showProvider={showProvider}\n          showSkills={showSkills}\n          badges={\n            (playlistView === 'collection' &&\n              asset?.__typename &&\n              ([{ name: asset?.__typename, actionType: 'prominent' }] as BadgeType[])) ||\n            []\n          }\n          videoFallbackImage={videoFallbackImage}\n          isCollection={playlistView === 'collection'}\n          orientation={carouselOrientation}\n          sponsoringDetails={undefined} // todo: allow sponsored assets to curate custom content\n          showBookmark={showBookmark}\n          showLock={showLock}\n          isDisabled={disabled}\n          assetView={playlistView}\n          assetIndex={index}\n          fontSize=\"sm\"\n          strategyType={strategyType}\n          renderAddToBookmarkButton={renderAddToBookmarkButton}\n          onClick={(e: React.MouseEvent<HTMLElement, MouseEvent>) =>\n            handleAssetClick(assetsPerSlide)(e, asset, index, slideIndex)\n          }\n          onLockClick={(e: React.MouseEvent<HTMLElement, MouseEvent>) =>\n            handleLockClick(assetsPerSlide)(e, asset, index, slideIndex)\n          }\n          loading={loading}\n          layout={playlistLayout}\n          asset={assetTileAsset}\n          lazyLoad={lazyLoad}\n          inView={inView}\n        />\n      </Wrapper>\n    )\n  }\n\n  const renderAssets = () => {\n    if (!promoted)\n      return [...assets.map(renderAsset(assetsPerSlideWithHook)), <div key=\"right-spacer\" />]\n    const promotedElement: (boolean | JSX.Element | null)[] = promoted ? [promoted] : []\n    return [\n      ...assets.slice(0, promotedIndex).map(renderAsset(assetsPerSlideWithHook)),\n      ...promotedElement,\n      ...assets.slice(promotedIndex).map(renderAsset(assetsPerSlideWithHook)),\n      <div key=\"right-spacer\" />,\n    ]\n  }\n\n  return (\n    <CarouselWrapper\n      tileMargin={tileMargin}\n      isGridLayout={isGridLayout}\n      tileWidth={tileWidth}\n      setFixedWidth={slidesPerPageSettings?.desktop >= 4 || assets.length < 4}\n      ref={ref}\n      key={`Carousel-${assets.length}`}\n      {...(typeof dataTest !== 'undefined' && { 'data-test': dataTest })}>\n      {sponsoringDetails ? (\n        <AssetSponsoring layout=\"carousel\" sponsoringDetails={sponsoringDetails} />\n      ) : null}\n      <ScrollSnapSlider\n        slideWidth={tileWidth}\n        isGridLayout={isGridLayout}\n        withGrid={withGrid}\n        showScrollbar={withScrollbar && assets.length > 3}\n        onScrollStart={() => {\n          if (!scrolled) scrolledSet(true)\n        }}\n        onScrollEnd={handleSlideChange(assetsPerSlideWithHook)}\n        showArrows={showArrows && assets.length > 3}\n        arrowDataTest=\"scroll-snap-slider-arrow\"\n        arrowPrevClass={arrowPrevClass}\n        arrowNextClass={arrowNextClass}\n        fixedArrowPosition={fixedArrowPosition}\n        zeroArrowPosition={zeroArrowPosition}\n        slidesPerPageSettings={slidesPerPageSettings}\n        title={title}>\n        {renderAssets()}\n      </ScrollSnapSlider>\n    </CarouselWrapper>\n  )\n}\n"],"names":["AssetCarousel","loading","lazyLoad","promoted","promotedIndex","assets","disabledAssetIndexes","context","tileMargin","withOverflow","withGrid","showArrows","showBookmark","NoAssetsComponent","showSkills","showProvider","sponsoringDetails","showLock","playlistOrientation","playlistView","playlistLayout","AssetTileLayout","gridItem","strategyType","videoFallbackImage","fixedArrowPosition","zeroArrowPosition","renderAddToBookmarkButton","title","tileWidth","slidesPerPageSettings","hideDummies","dataTest","withLQIP","withNativeLoading","withScrollbar","onAssetClick","onLockClick","onSlideChange","onInView","arrowPrevClass","arrowNextClass","useState","scrolled","scrolledSet","breakpoint","useWindowDimensions","prevSlideIndex","setPrevSlideIndex","assetsPerSlideWithHook","breakpoints","lg","desktop","md","tablet","mobileBig","useInView","threshold","triggerOnce","rootMargin","ref","inView","useEffect","undefined","length","assetsPerSlide","handleLockClick","event","asset","index","pageNumber","tileSettings","fontSize","withEllipsis","carouselOrientation","isGridLayout","renderAsset","slideIndex","Math","floor","isDummyTile","description","assetTileAsset","Wrapper","isSponsored","TileFragment","TileWrapper","assetsWithSponsor","sponsored","disabled","findIndex","x","React","hideDummy","key","withLabels","AssetTile","badges","__typename","name","actionType","isCollection","orientation","isDisabled","assetView","assetIndex","onClick","e","preventDefault","locked","handleAssetClick","layout","CarouselWrapper","setFixedWidth","AssetSponsoring","ScrollSnapSlider","slideWidth","showScrollbar","onScrollStart","onScrollEnd","nextSlideIndex","direction","assetsInSlide","slice","assetAmount","arrowDataTest","map","promotedElement","renderAssets"],"mappings":"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"}